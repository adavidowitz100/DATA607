---
title: "Project 2 - Part 1"
author: "Avery Davidowitz"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Introduction
My classmate Sanielle Worrell posted an excellent example of wide data generated by Zillow and proposed using Zillow data to analyze the change in New York City home prices over the last year. The data utilizes a Zillow methodology called ZHVI (Zillow Home Value Index) which represents "smoothed, seasonally adjusted measure of the typical home value and market changes across a given region and housing type... for homes in the 35th to 65th percentile range." Sanielle proposed doing the analysis with ZHVI by zip code. However, my analysis below uses ZHVI by county due to the sheer quantity of data involved (a 50MB CSV for zip codes compared to 5MB for county). The methodology does not differ in any significant way from this change; The data is imported, converted to a long Tidy format, converted to correct types and subset for analysis. The data is freely available at https://www.zillow.com/research/data/

## Import Libraries

```{r}
library(tidyverse)
```


## Load Data
Load the data from a CSV file stored on Github for reproducibility.
```{r}
theUrl <- "https://raw.githubusercontent.com/adavidowitz100/DATA607/main/Project2/County_zhvi_uc_sfr_tier_0.33_0.67_sm_sa_month.csv"
zillow_data <- read.table(file=theUrl, header=TRUE, sep=",", na.strings = "", stringsAsFactors = FALSE)
head(zillow_data)
```

## Data Munging into Tidy Data

Convert data from wide format to Tidy long format by moving monthly price from multiple columns to 2 new date and price name/value columns.
```{r}
long_zillow_data <- tidyr::pivot_longer(zillow_data, cols = starts_with("X2"), names_to = "Start_Date", values_to = "Price")
head(long_zillow_data)
```


Format new Date column to correct date data type
```{r}
long_zillow_data <- long_zillow_data |> dplyr::mutate(Start_Date = stringr::str_sub(Start_Date, start =  2)) |>
                                        dplyr::mutate(Start_Date = as.Date(Start_Date,format="%Y.%m.%d"))

head(long_zillow_data)
```

Sub-setting to New York City Counties for last 2 years only

```{r}
borough_data <- long_zillow_data |> dplyr::filter(State == "NY" & RegionName %in% c("Kings County","Queens County","New York County","Bronx County","Richmond County") & Start_Date > as.Date("2020-08-01")) |>
  dplyr::select(RegionName, Start_Date, Price)
head(long_zillow_data)
```

## Analysis

Plotting the data for the 24 months prior can give a good and quick overview of the price changes over the past 24 months.

A plot of all 5 Boroughs.
```{r}
ggplot(borough_data,aes(x=Start_Date, y=Price)) + geom_line(aes(color=factor(RegionName), group=RegionName)) + scale_color_discrete(name="County") + labs(title="New York City Home Values 2020-2022", x="Date", y="Price")
```

Plotting the trend over the past 24 months for all five Boroughs' prices combined.

```{r}
nyc_data <- borough_data |> dplyr::select(Start_Date, Price) |> 
  dplyr::group_by(Start_Date) |>
  dplyr::summarise(average = mean(Price))

ggplot(nyc_data,aes(x=Start_Date, y=average)) + geom_line() + labs(title="New York City Home Values 2020-2022", x="Date", y="Price")
```

## Conclusion
As supported by the plots, all of the 5 Boroughs of New York City experienced steady single home value price increases month over month and year over year for the 24 months between 8/20 and 8/22.































